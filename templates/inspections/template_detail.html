{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ template.template_name }} - Template Detail{% endblock %}
{% block page_title %}Template Details{% endblock %}

{% block extra_css %}
<style>
.template-header {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
    padding: 30px;
    border-radius: 10px 10px 0 0;
}

.category-section {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    background-color: #fff;
}

.category-header {
    background-color: #f8f9fa;
    padding: 15px;
    border-left: 4px solid #17a2b8;
    border-radius: 5px;
    margin-bottom: 15px;
}

.inspection-point-item {
    padding: 15px;
    border-bottom: 1px solid #e9ecef;
    display: flex;
    align-items: start;
}

.inspection-point-item:last-child {
    border-bottom: none;
}

.point-number {
    background-color: #17a2b8;
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0;
    margin-right: 15px;
}

.point-content {
    flex: 1;
}

.point-badges {
    display: flex;
    gap: 5px;
    margin-top: 8px;
}
</style>
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboards:home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'inspections:dashboard' %}">Inspection Management</a></li>
<li class="breadcrumb-item"><a href="{% url 'inspections:template_list' %}">Templates</a></li>
<li class="breadcrumb-item active">{{ template.template_name }}</li>
{% endblock %}

{% block content %}

<div class="card ehs-card">
    <!-- Template Header -->
    <div class="template-header">
        <div class="row">
            <div class="col-md-8">
                <h3 class="mb-2">
                    <i class="fas fa-clipboard-list mr-2"></i>
                    {{ template.template_name }}
                </h3>
                <p class="mb-2">
                    <strong>Template Code:</strong> {{ template.template_code }} | 
                    <strong>Document:</strong> {{ template.document_number|default:"N/A" }}
                </p>
                {% if template.description %}
                <p class="mb-0">{{ template.description }}</p>
                {% endif %}
            </div>
            <div class="col-md-4 text-right">
                <div class="mb-2">
                    <span class="badge badge-light badge-lg" style="font-size: 1rem;">
                        <i class="fas fa-calendar-alt mr-1"></i>
                        {{ template.get_frequency_display }}
                    </span>
                </div>
                <div class="mb-2">
                    {% if template.is_active %}
                    <span class="badge badge-success badge-lg" style="font-size: 1rem;">
                        <i class="fas fa-check-circle mr-1"></i>Active
                    </span>
                    {% else %}
                    <span class="badge badge-secondary badge-lg" style="font-size: 1rem;">
                        <i class="fas fa-ban mr-1"></i>Inactive
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="row mt-3">
            <div class="col-md-4 text-center">
                <h2 class="mb-0">{{ categories.count }}</h2>
                <small>Categories</small>
            </div>
            <div class="col-md-4 text-center">
                <h2 class="mb-0">{{ template.total_inspection_points }}</h2>
                <small>Total Inspection Points</small>
            </div>
            <div class="col-md-4 text-center">
                <h2 class="mb-0">{{ template.created_at|date:"M Y" }}</h2>
                <small>Created</small>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        <!-- Action Buttons -->
        <div class="mb-4">
            <a href="{% url 'inspections:template_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left mr-1"></i>Back to Templates
            </a>
            {% if user.is_superuser %}
            <a href="/admin/inspections/inspectiontemplate/{{ template.id }}/change/" 
               class="btn btn-warning" 
               target="_blank">
                <i class="fas fa-edit mr-1"></i>Edit Template
            </a>
            {% endif %}
        </div>

        <!-- Categories and Points -->
        <h5 class="mb-3">
            <i class="fas fa-list mr-2"></i>Template Structure
        </h5>
        
        {% for category in categories %}
        <div class="category-section">
            <div class="category-header">
                <h6 class="mb-0">
                    <i class="fas fa-folder-open mr-2"></i>
                    {{ forloop.counter }}. {{ category.category_name }}
                    <span class="badge badge-info float-right">
                        {{ category.inspection_points.count }} Points
                    </span>
                </h6>
            </div>
            
            {% for point in category.inspection_points.all %}
            <div class="inspection-point-item">
                <div class="point-number">
                    {{ forloop.counter }}
                </div>
                
                <div class="point-content">
                    <p class="mb-1">{{ point.inspection_point_text }}</p>
                    
                    <div class="point-badges">
                        {% if point.is_mandatory %}
                        <span class="badge badge-danger">
                            <i class="fas fa-exclamation-circle mr-1"></i>Mandatory
                        </span>
                        {% endif %}
                        
                        {% if point.requires_photo %}
                        <span class="badge badge-warning">
                            <i class="fas fa-camera mr-1"></i>Photo Required
                        </span>
                        {% endif %}
                        
                        {% if not point.is_active %}
                        <span class="badge badge-secondary">
                            <i class="fas fa-ban mr-1"></i>Inactive
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center text-muted py-3">
                <i class="fas fa-info-circle mr-1"></i>
                No inspection points in this category
            </div>
            {% endfor %}
        </div>
        {% empty %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            This template has no categories defined yet.
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}