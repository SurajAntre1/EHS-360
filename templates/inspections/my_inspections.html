
{% extends 'base/base.html' %}

{% block title %}My Inspections{% endblock %}
{% block page_title %}My Inspections{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboards:home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'inspections:inspection_dashboard' %}">Inspections</a></li>
<li class="breadcrumb-item active">My Inspections</li>
{% endblock %}

{% block content %}
<!-- Stats Row -->
<div class="row mb-3">
    <div class="col-md-3">
        <div class="info-box">
            <span class="info-box-icon bg-primary"><i class="fas fa-calendar"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Scheduled</span>
                <span class="info-box-number">{{ stats.scheduled }}</span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box">
            <span class="info-box-icon bg-warning"><i class="fas fa-clock"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">In Progress</span>
                <span class="info-box-number">{{ stats.in_progress }}</span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box">
            <span class="info-box-icon bg-success"><i class="fas fa-check"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Completed</span>
                <span class="info-box-number">{{ stats.completed }}</span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box">
            <span class="info-box-icon bg-danger"><i class="fas fa-exclamation-triangle"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Overdue</span>
                <span class="info-box-number">{{ stats.overdue }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-3" style="background: var(--light-blue);">
    <div class="card-body">
        <form method="get" class="form-inline">
            <label class="mr-2">Filter by Status:</label>
            <select name="status" class="form-control mr-2">
                {% for value, label in status_choices %}
                <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Apply
            </button>
        </form>
    </div>
</div>

<!-- Inspections List -->
<div class="ehs-card">
    <div class="card-header">
        <h3 class="card-title"><i class="fas fa-clipboard-check"></i> My Assigned Inspections</h3>
    </div>
    <div class="card-body">
        {% if page_obj %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Schedule Code</th>
                        <th>Template</th>
                        <th>Plant/Department</th>
                        <th>Scheduled Date</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for schedule in page_obj %}
                    <tr>
                        <td><strong>{{ schedule.schedule_code }}</strong></td>
                        <td>{{ schedule.template.template_name }}</td>
                        <td>
                            {{ schedule.plant.name }}
                            {% if schedule.department %}
                            <br><small class="text-muted">{{ schedule.department.name }}</small>
                            {% endif %}
                        </td>
                        <td>{{ schedule.scheduled_date|date:"d M Y" }}</td>
                        <td>
                            {{ schedule.due_date|date:"d M Y" }}
                            {% if schedule.is_overdue %}
                            <br><span class="badge badge-danger">Overdue</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge 
                                {% if schedule.status == 'SCHEDULED' %}badge-primary
                                {% elif schedule.status == 'IN_PROGRESS' %}badge-warning
                                {% elif schedule.status == 'COMPLETED' %}badge-success
                                {% elif schedule.status == 'OVERDUE' %}badge-danger
                                {% else %}badge-secondary{% endif %}">
                                {{ schedule.get_status_display }}
                            </span>
                        </td>
                        <td class="table-actions">
                        {% if schedule.status == 'SCHEDULED' %}
                        <a href="{% url 'inspections:inspection_start' schedule.id %}" 
                        class="btn btn-sm btn-success" title="Start Inspection">
                            <i class="fas fa-play"></i> Start
                        </a>
                        {% elif schedule.status == 'IN_PROGRESS' %}
                        <a href="{% url 'inspections:inspection_start' schedule.id %}" 
                        class="btn btn-sm btn-warning" title="Continue Inspection">
                            <i class="fas fa-edit"></i> Continue
                        </a>
                        {% endif %}
                        
                        <a href="{% url 'inspections:schedule_detail' schedule.pk %}" 
                        class="btn btn-sm btn-info" title="View Details">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&status={{ selected_status }}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}&status={{ selected_status }}">{{ num }}</a>
                </li>
                {% endfor %}
                
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&status={{ selected_status }}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-clipboard-list fa-4x text-muted mb-3"></i>
            <p class="text-muted">No inspections assigned to you yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}