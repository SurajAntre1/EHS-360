{% extends 'base/base.html' %}
{% load static %}

{% block title %}Create Role{% endblock %}
{% block page_title %}Create Role{% endblock %}

{% block extra_css %}
<style>
  .role-label {
    font-size: 15px;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 12px;
    display: block;
  }

  @media (max-width: 768px) {
    .permissions-box {
      max-height: 250px;
    }
    .permission-row {
      padding: 10px;
      gap: 10px;
    }
  }

  .permission-row:focus-within {
    background-color: #eff6ff;
    border: 2px solid #3b82f6;
    margin: -1px;
    padding: 11px 13px;
  }

  .permission-checkbox:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
  }
  .permission-row {
    position: relative;
  }

  .permissions-box {
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 16px;
    max-height: 300px;
    overflow-y: auto;
    background-color: #fff;
  }

  .permission-row {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 14px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.15s ease;
    margin-bottom: 8px;
  }

  .permission-row:hover {
    background-color: #f1f5f9;
  }

  .permission-row input {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  .permission-label {
    font-size: 14px;
    color: #111827;
    cursor: pointer;
    user-select: none;
  }

  .btn-spacing {
    margin-right: 12px !important;
  }

  .form-section {
    margin-bottom: 1rem;
  }

  .permissions-header {
    margin-bottom: 1.25rem;
  }
</style>
{% endblock extra_css %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <form method="post" id='role_form'>
      {% csrf_token %}

      <div class="form-section">
        <label class="role-label">
          Role <span class="text-danger">*</span>
        </label>
        <div class="role-select-wrapper">
        <input type="text" class="form-control" id="role_name" name="role_name" placeholder="Enter role name" required maxlength="100">
        </div>
      </div>

      <div class="form-section">
        <label class="form-label fw-semibold">Description</label>
        <textarea
          id = "role_description"
          name="description"
          class="form-control"
          rows="3"
          placeholder="Enter role description"
        ></textarea>
      </div>

      <div class="d-flex justify-content-between align-items-center permissions-header">
        <label class="fw-semibold mb-0">Permissions</label>
        <div>
          <button type="button" class="btn btn-outline-secondary btn-sm me-2" onclick="selectAll()">
            Select All
          </button>
          <button type="button" class="btn btn-outline-secondary btn-sm" onclick="deselectAll()">
            Deselect All
          </button>
        </div>
      </div>

      <div class="permissions-box">
      {% if permission %}
        {% for perm in permission %}
          <div class="permission-row">
            <input
              class="permission-checkbox"
              type="checkbox"
              name="permissions"
              value="{{ perm.permission_id }}"
              id="perm_{{ perm.permission_id }}"
            >
            <label for="perm_{{ perm.permission_id }}">
              {{ perm.permission_name }}
            </label>
          </div>
        {% endfor %}
      {% else %}
        <p>No permissions available</p>
      {% endif %}
    </div>


      <div class="d-flex justify-content-end mt-5">
        <a href="#" class="btn btn-outline-secondary btn-spacing">
          Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          Create Role
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
  function selectAll() {
    document.querySelectorAll(".permission-checkbox")
      .forEach(cb => cb.checked = true);
  }

  function deselectAll() {
    document.querySelectorAll(".permission-checkbox")
      .forEach(cb => cb.checked = false);
  }

  function isChecked(rowElement, event) {
  if (event.target.tagName !== "INPUT") {
    const checkbox = rowElement.querySelector(".permission-checkbox");
    if (checkbox) {
      checkbox.checked = !checkbox.checked;
    }
  }
}
  
// Form submission
document.getElementById('role_form').addEventListener('submit',function(e){
  const name = document.getElementById('role_name').value.trim();
  const description = document.getElementById('role_description').value.trim();
  const permissions = [];
  document.querySelectorAll('.permission-checkbox:checked').forEach(checkbox => {
    permissions.push(checkbox.value);
  });
});
  
</script>
{% endblock extra_js %}
